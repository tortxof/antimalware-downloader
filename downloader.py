#! /usr/bin/env python3

import os
import re
import subprocess

import requests
from bs4 import BeautifulSoup

dl_dir = 'downloads'

def get_refresh_url(url):
    r = requests.get(url)
    soup = BeautifulSoup(r.text, 'html5')
    meta_tags = soup.find_all('meta', attrs={'http-equiv': 'refresh'}, content=re.compile('^3'))
    return meta_tags[0]['content'].split(';')[1].strip().split('url=')[1]

with open('urls.txt') as f:
    urls = f.readlines()

if not os.path.isdir(dl_dir):
    os.mkdir(dl_dir)
os.chdir(dl_dir)

dl_command = ['curl', '-L']
for i in urls:
    url = get_refresh_url(i)
    if '32/FixExec.exe' in url:
        subprocess.call(dl_command + ['-o', 'FixExec-32.exe'] + [url])
    elif '64/FixExec.exe' in url:
        subprocess.call(dl_command + ['-o', 'FixExec-64.exe'] + [url])
    elif 'HitmanPro_x64.exe' in url:
        subprocess.call(dl_command + ['-o', 'HitmanPro-64.exe'] + [url])
    elif 'HitmanPro.exe' in url:
        subprocess.call(dl_command + ['-o', 'HitmanPro-32.exe'] + [url])
    elif 'mbam-setup.exe' in url:
        subprocess.call(dl_command + ['-o', 'mbam-setup.exe'] + [url])
    else:
        subprocess.call(dl_command + ['-O', '-J'] + [url])
